TESTS = test/*.js
REPORTER = dot

MODULES_FOLDER = modules

test:
	@DEBUG=$DEBUG,monk,monk:queries ./node_modules/.bin/mocha \
		--require test/common.js \
		--reporter $(REPORTER) \
		--growl \
		--bail \
		--slow 1000 \
		$(TESTS)

monk2:
	npm install
	mkdir lib
	mkdir lib/$(MODULES_FOLDER)
	cp -r node_modules/monk/lib ./
	cp -r node_modules/monk/test ./
	mv node_modules/monk/node_modules/* lib/$(MODULES_FOLDER)
	rm -rf node_modules/monk

	sed "s/require('mongoskin')/require('.\/$(MODULES_FOLDER)\/mongoskin')/g" lib/manager.js > lib/manager2.js
	mv lib/manager2.js lib/manager.js

clean:
	rm -rf lib
	rm -rf test
	rm -rf node_modules

.PHONY: test bench
